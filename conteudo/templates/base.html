<!DOCTYPE html>
<html lang="pt-BR" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonar</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'style.css' %}">

<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:_ApprovalStatus msdt:dt="string">0</mso:_ApprovalStatus>
<mso:_ApprovalAssignedTo msdt:dt="string"></mso:_ApprovalAssignedTo>
<mso:_ApprovalRespondedBy msdt:dt="string"></mso:_ApprovalRespondedBy>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>
<body>

    <header>

        <div class="header-navbar__content">

            <div class="header-navbar__content-logo">
                <div class="sidebar-toggle">
                     <button abrir-menu=""> <!-- id="abrir-sidebar" -->
                        <i>游</i>
                    </button>
                </div>
                <div class="navbar-logo">
                    <a href="/"><strong>Sonar</strong></a>
                </div>
            </div>

            <div class="header-navbar__content-barra" data-component="user-auth">
                
                <div>
                    <a href="{% url 'metodologia' %}" class="header-navbar__btn">
                        <strong>Metodologia</strong>
                    </a>
                </div>
                
                <div>
                    <a href="{% url 'sobre' %}" class="header-navbar__btn">
                        <strong>Sobre</strong>
                    </a>
                </div>

                <div data-target="loginButton">
                    <a href="/" class="header-navbar__btn">
                        <strong>Entrar</strong>
                    </a>
                </div>

                <div data-target="userMenu" style="display: none;">
                    <a href="#" class="header-navbar__btn">
                        <strong>Minha Conta</strong>
                    </a>
            </div>

</div>

        </div>

        <div id="sidebar-menu" class="sidebar-menu"> <!-- id="menu" -->
            <aside class="sidebar-menu__wrapper"> <!-- Aqui fica a Sidebar(Oculta naturalmente) -->
                <div class="sidebar-menu__container">
                    <div class="main-menu">
                        
                        <a href="/" style="text-decoration: none;" class="main-menu__item">In칤cio</a>
                        <div class="separador"></div>
                        <div style="padding-left: 16px; margin-bottom: 8px; font-size: 12px; color: #888; text-transform: uppercase; font-weight: bold;">Navega칞칚o R치pida</div>

                        {% for div in sidebar_divergencias %}
                            <a href="{% url 'divergencias' div.slug %}" class="main-menu__item" title="{{ div.nome }}" style="text-decoration: none;">
                                {{ div.nome }}
                            </a>
                        {% empty %}
                            {% endfor %}

                        <div class="separador"></div>
                        <a href="#" class="main-menu__item" title="Perfil" style="text-decoration: none;">Perfil</a>
                        <a href="{% url 'contato' %}" class="main-menu__item" title="Contato" style="text-decoration: none;">Contato</a>
                        <a href="#" class="main-menu__item" title="Tema da P치gina" style="text-decoration: none;">Tema da P치gina</a>
                    </div>
                </div>
            </aside>
            
                <div class="sidebar-footer">
                    <div class="footer-links">
                        <a href="/sobre/">Sobre</a>   
                        <a href="#">Imprensa</a>
                        <a href="#">Direitos autorais</a>
                        <a href="#">Entre em contato</a>
                        <a href="#">Criadores</a>
                        <a href="#">Desenvolvedores</a>
                    </div>
                    <div class="footer-links">
                        <a href="#">Termos</a>
                        <a href="#">Privacidade</a>
                        <a href="#">Pol칤tica e Seguran칞a</a>
                        <a href="/metodologia/">Como funciona o Sonar</a>
                    </div>
                    <div class="footer-copyright">
                        춸 2025 Sonar LLC
                    </div>
                </div>
                </div> <div id="sidebar-overlay" class="sidebar-overlay"></div>
        </header>

        </div>
        <div id="sidebar-overlay" class="sidebar-overlay"></div>
    </header>

    <main id="main">
        {% block conteudo %}
        {% endblock %}
    </main>

    <script>
        // --- BLOQUEIO DO BOT츾O VOLTAR NA HOME ---
        // Se a url for apenas "/" (Home), impede de voltar
        if (window.location.pathname === '/') {
            // Cria um estado no hist칩rico para "prender" o usu치rio
            history.pushState(null, null, window.location.href);
            
            // Sempre que ele tentar voltar (clicar no bot칚o do mouse ou do navegador)
            window.addEventListener('popstate', function () {
                // Empurra ele de volta para a p치gina atual
                history.pushState(null, null, window.location.href);
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            // 1. Seleciona os elementos
            const botoes = document.querySelectorAll('[abrir-menu]');
            const menu = document.getElementById("sidebar-menu");
            const overlay = document.getElementById("sidebar-overlay");
            const main = document.getElementById("main");

            // --- L칍GICA DE PERSIST칅NCIA (Local Storage) ---

            // Fun칞칚o para aplicar o estado (Abrir ou Fechar)
            function setMenuState(isOpen, animate = true) {
                if (!animate) {
                    menu.style.transition = 'none';
                    main.style.transition = 'none';
                    overlay.style.transition = 'none';
                }

                if (isOpen) {
                    menu.classList.add('is-open');
                    overlay.classList.add('is-open');
                    main.classList.add('is-open');
                } else {
                    menu.classList.remove('is-open');
                    overlay.classList.remove('is-open');
                    main.classList.remove('is-open');
                }

                localStorage.setItem('sidebarAberta', isOpen);

                if (!animate) {
                    void menu.offsetWidth; 
                    setTimeout(() => {
                        menu.style.transition = '';
                        main.style.transition = '';
                        overlay.style.transition = '';
                    }, 50);
                }
            }

            // 2. Verifica se j치 estava aberto antes
            const estadoSalvo = localStorage.getItem('sidebarAberta') === 'true';
            
            if (estadoSalvo) {
                setMenuState(true, false); 
            }

            // --- EVENTOS DE CLIQUE ---

            // 3. Clique nos bot칫es de abrir/fechar
            botoes.forEach(botao => {
                botao.addEventListener('click', () => {
                    const isCurrentlyOpen = menu.classList.contains('is-open');
                    setMenuState(!isCurrentlyOpen, true); 
                });
            });

            // 4. Clique no Overlay para fechar
            if (overlay) {
                overlay.addEventListener('click', () => {
                    setMenuState(false, true);
                });
            }

            // --- L칍GICA DE LOGIN ---
            const component = document.querySelector('[data-component="user-auth"]');
            if (component) {
                const loginTarget = component.querySelector('[data-target="loginButton"]');
                const menuTarget = component.querySelector('[data-target="userMenu"]');
                const usuarioEstaLogado = true; // Mude para testar

                if (usuarioEstaLogado) {
                    if(loginTarget) loginTarget.style.display = 'none';
                    if(menuTarget) menuTarget.style.display = 'block';
                } else {
                    if(loginTarget) loginTarget.style.display = 'block';
                    if(menuTarget) menuTarget.style.display = 'none';
                }
            }
        });
    </script>

</body>
</html>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>